<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8" />
  <title>Logistics App</title>
  <meta name="viewport"
    content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <link rel="icon" type="image/x-icon" href="./assets/icon/favicon.ico" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./css/style.css" />
  <meta name="theme-color" content="#008080" />
</head>

<body>
  <div class="container" style="display: none;">
    <input type="text" placeholder="Enter Telegram group link">
    <button>SAVE</button>
  </div>
  
  <script src="./js/capacitor-welcome.js" type="module"></script>
  <script type="module">
    import { AppLauncher } from '@capacitor/app-launcher';
    if (!localStorage.getItem('link')) {
      document.querySelector('.container').style.display = 'flex';
    }

    // Save link to local storage

    document.querySelector('button').addEventListener('click', async () => {
      const urlRegex = /^https:\/\/t\.me\/\+([a-zA-Z0-9]+)$/;
      const link = document.querySelector('input').value;
      if (!urlRegex.test(link)) {
        alert('Invalid link!');
        return;
      }
      localStorage.setItem('link', urlRegex.exec(link)[1]);
        return AppLauncher.openUrl({ url: `https://t.me/+${localStorage.getItem('link')}` });
    });

    // Others

    let counter = 0;

    document.addEventListener("visibilitychange", () => {
      if (document.visibilityState === 'visible' && counter >= 1) {
        window.location.reload();
      }
      counter++;
    });

  </script>
</body>

</html>